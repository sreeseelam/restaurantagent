<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Restaurant Assistant</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-white text-gray-800 font-sans">
  <!-- Main Home Content -->
  <main class="p-8 max-w-4xl mx-auto">
    <h1 class="text-4xl font-bold mb-4">Welcome to Spice Garden Restaurant</h1>
    <p class="mb-6 text-lg">Discover authentic Indian cuisine with a curated selection of dishes made from fresh ingredients. Explore our menu, compare prices, and get help creating your perfect order!</p>

    <section class="mb-8">
      <h2 class="text-2xl font-semibold mb-2">Popular Dishes</h2>
      <ul class="list-disc ml-6 text-lg">
        <li>Paneer Butter Masala - â‚¹250</li>
        <li>Chicken Biryani - â‚¹320</li>
        <li>Garlic Naan - â‚¹60</li>
        <li>Chole Bhature - â‚¹180</li>
        <li>Mango Lassi - â‚¹90</li>
      </ul>
    </section>

    <section>
      <h2 class="text-2xl font-semibold mb-2">Opening Hours</h2>
      <p class="text-lg">Monday - Sunday: 11:00 AM - 11:00 PM</p>
    </section>
  </main>

  <!-- Floating Chat Button -->
  <button id="chat-toggle" onclick="toggleChat()" class="fixed bottom-6 right-6 bg-blue-600 text-white p-4 rounded-full shadow-lg hover:bg-blue-700">
    ðŸ’¬ Chat
  </button>

  <!-- Chat Widget -->
  <div id="chat-box" class="hidden fixed bottom-20 right-6 w-96 max-h-[80vh] flex flex-col border rounded-lg shadow-lg bg-white">
    <div class="bg-blue-600 text-white p-3 font-semibold rounded-t-lg">Ask the Assistant</div>
    <div id="chat-container" class="flex-1 overflow-y-auto p-4 space-y-2 bg-gray-100"></div>
    <div class="flex items-center p-2 border-t bg-white">
      <textarea id="user-input" rows="1" placeholder="Type your message..." class="flex-1 p-2 border rounded resize-none focus:outline-none focus:ring" onkeydown="handleEnter(event)"></textarea>
      <button onclick="sendMessage()" class="ml-2 px-3 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Send</button>
      <button onclick="resetChat()" class="ml-2 px-3 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400">Reset</button>
    </div>
  </div>

  <script>
    let sessionId = "session_" + Math.random().toString(36).substring(2);

    async function startSession() {
      const res = await fetch('/start-session', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ session_id: sessionId })
      });
      const data = await res.json();
      console.log('Session started:', data);
    }

    async function sendMessage() {
      const input = document.getElementById('user-input');
      const message = input.value.trim();
      if (!message) return;

      appendMessage('user', message);
      input.value = '';
      appendMessage('assistant', 'Typing...', true);

      const res = await fetch('/send-message', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ session_id: sessionId, message })
      });

      const data = await res.json();
      removeTyping();
      appendMessage('assistant', data.response);
    }

    async function resetChat() {
      await fetch('/clear-session', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ session_id: sessionId })
      });
      sessionId = "session_" + Math.random().toString(36).substring(2);
      await startSession();
      document.getElementById('chat-container').innerHTML = '';
    }

    function appendMessage(role, content, isTyping = false) {
      const div = document.createElement('div');
      div.className = `message ${role}`;
      div.classList.add("text-sm", "rounded", "p-2", "max-w-xl", "whitespace-pre-wrap");
      const roleClasses = role === 'user'
        ? ["bg-blue-100", "self-end"]
        : ["bg-green-100", "self-start"];
      div.classList.add(...roleClasses);
      div.textContent = `${role === 'user' ? 'You' : 'Assistant'}: ${content}`;
      if (isTyping) div.id = "typing-indicator";

      const time = document.createElement('div');
      time.className = "text-xs text-gray-500 mt-1";
      time.textContent = new Date().toLocaleTimeString();
      div.appendChild(time);

      document.getElementById('chat-container').appendChild(div);
      div.scrollIntoView({ behavior: 'smooth' });
    }

    function removeTyping() {
      const typing = document.getElementById('typing-indicator');
      if (typing) typing.remove();
    }

    function handleEnter(event) {
      if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault();
        sendMessage();
      }
    }

    function toggleChat() {
      const chatBox = document.getElementById('chat-box');
      chatBox.classList.toggle('hidden');
      if (!chatBox.classList.contains('hidden')) {
        document.getElementById('user-input').focus();
      }
    }

    startSession();
  </script>
</body>
</html>